(function($,Drupal){"use strict";var fpa={selector:{form:"#user-admin-permissions",table:"#permissions"},dom:{},attr:{permission:"",module:""},filter_timeout:null,filter_timeout_time:0};var drupal_clean_css_identifier=function(str){return str.replace(/[ _\/\[]/g,"-").replace(/\]/g,"").replace(/[^\u002D\u0030-\u0039\u0041-\u005A\u005F\u0061-\u007A\u00A1-\uFFFF]/,"")};var drupal_html_class=function drupal_html_class_static(){var classes={};return function drupal_html_class(str){if(typeof classes[str]==="undefined"){classes[str]=drupal_clean_css_identifier(str.toLowerCase())}return classes[str]}}();var set_style=function(){if($('<style type="text/css" />').get(0).styleSheet){return function(element,styles){element.styleSheet.cssText=styles}}else{return function(element,styles){element.innerHTML=styles}}}();fpa.filter_module=function(e){e.preventDefault();e.stopPropagation();var $this=$(this);var current_perm=fpa.dom.filter.val().replace(/(@.*)/,"");current_perm+=$this.attr(fpa.attr.module)!==""?"@"+$this.find("a[href]").text():"";fpa.dom.filter.val(current_perm);fpa.filter("~=")};fpa.build_filter_selectors=function build_filter_selectors_static(){var selectors={"*=":{},"~=":{}};return function build_filter_selectors(filter_string,module_match){module_match=selectors.hasOwnProperty(module_match)?module_match:"*=";filter_string=filter_string||fpa.dom.filter.val();if(typeof selectors[module_match][filter_string]==="undefined"){var filter_selector=["",""];if($.inArray(filter_string,["","@"])===-1){var matches=filter_string.match(/([^@]*)@?(.*)/i);matches.shift();var matches_safe=$.map(matches,drupal_html_class);if(matches_safe[0].length>0){filter_selector[0]="["+fpa.attr.permission+'*="'+matches_safe[0]+'"]'}if(matches_safe[1].length>0){filter_selector[1]="["+fpa.attr.module+module_match+'"'+matches_safe[1]+'"]'}}selectors[module_match][filter_string]=filter_selector}return selectors[module_match][filter_string]}}();fpa.filter=function(module_match){module_match=typeof module_match==="string"?module_match:"*=";var table_base_selector=".fpa-table-wrapper tr["+fpa.attr.module+"]";var list_counter_selector=".fpa-left-section .item-list li span["+fpa.attr.permission+"]";var list_base_selector=".fpa-left-section .item-list li["+fpa.attr.module+"]";var module_active_style="{margin-right:-1px; background-color: white; border-right: solid 1px transparent;}";var perm=fpa.dom.filter.val();$.cookie("fpa_filter",perm,{path:"/"});fpa.dom.filter.get(0).defaultValue=perm;var perm_style_code="";var filter_selector=fpa.build_filter_selectors(perm,module_match);if($.inArray(perm,["","@"])===-1){perm_style_code+=table_base_selector+filter_selector.join("")+"{display: table-row;}";perm_style_code+=list_counter_selector+filter_selector[0]+"{display: inline;}";if(filter_selector[1].length>0){perm_style_code+=list_base_selector+filter_selector[1]+module_active_style}perm_style_code+=table_base_selector+"{display: none;}";if(filter_selector[0].length>0){perm_style_code+=list_counter_selector+"{display: none;}"}if(filter_selector[1].length===0){perm_style_code+=list_base_selector+"["+fpa.attr.module+'=""]'+module_active_style}}else{perm_style_code+=list_base_selector+"["+fpa.attr.module+'=""]'+module_active_style}set_style(fpa.dom.perm_style,perm_style_code)};fpa.build_role_selectors=function(roles){roles=roles||fpa.dom.role_select.val();var selectors=[];if($.inArray("*",roles)===-1){$.each(roles,function(index,value){selectors.push("["+fpa.attr.role+'="'+value+'"]')})}else{selectors.push("*")}return selectors};fpa.filter_roles=function(){fpa.dom.role_select.find("option").each(function(){this.defaultSelected=this.selected});var values=fpa.dom.role_select.val()||[];var selector_array=[];var role_style_code="";$.cookie("fpa_roles",JSON.stringify(values),{path:"/"});if($.inArray("*",values)===-1){if(values.length>0){selector_array=fpa.build_role_selectors(values);$.each(selector_array,function(index,value){role_style_code+=".fpa-table-wrapper ["+fpa.attr.role+"]"+value+" {display: table-cell;}"});role_style_code+=selector_array.pop()+" {border-right: 1px solid #bebfb9;}"}else{role_style_code+='td[class="permission"] {border-right: 1px solid #bebfb9;}'}role_style_code+=".fpa-table-wrapper ["+fpa.attr.role+"] {display: none;}"}set_style(fpa.dom.role_style,role_style_code)};fpa.select=function(context){fpa.dom={};fpa.dom.context=$(context);fpa.dom.form=fpa.dom.context.find(fpa.selector.form);if(fpa.dom.form.length===0){return false}fpa.dom.container=fpa.dom.form.find(".fpa-container");fpa.dom.perm_style=fpa.dom.container.find(".fpa-perm-styles style").get(0);fpa.dom.role_style=fpa.dom.container.find(".fpa-role-styles style").get(0);fpa.dom.section_left=fpa.dom.container.find(".fpa-left-section");fpa.dom.section_right=fpa.dom.container.find(".fpa-right-section");fpa.dom.table_wrapper=fpa.dom.section_right.find(".fpa-table-wrapper");fpa.dom.table=fpa.dom.table_wrapper.find(fpa.selector.table);fpa.dom.module_list=fpa.dom.section_left.find("ul");fpa.dom.filter_form=fpa.dom.container.find(".fpa-filter-form");fpa.dom.filter=fpa.dom.filter_form.find('input[type="text"]');fpa.dom.role_select=fpa.dom.filter_form.find("select");return true};fpa.prepare=function(){fpa.filter_timeout_time=Math.min(fpa.dom.table.find("tr").length,200);fpa.dom.form.delegate(".fpa-toggle-container a","click",function _fpa_toggle(e){e.preventDefault();var $this=$(this);var toggle_class=$this.attr("fpa-toggle-class");var has_class=fpa.dom.container.toggleClass(toggle_class).hasClass(toggle_class);$.cookie(toggle_class,has_class,{path:"/"})});fpa.dom.section_left.delegate("li","click",fpa.filter_module);fpa.dom.filter.keypress(function _prevent_form_submission(e){if(e.which===13){e.preventDefault();e.stopPropagation()}}).keyup(function _fpa_filter_keyup(e){if($.inArray(e.which,[13,16,17,18])===-1){clearTimeout(fpa.filter_timeout);fpa.filter_timeout=setTimeout(function(){fpa.dom.table_wrapper.detach().each(function(){fpa.filter()}).appendTo(fpa.dom.section_right)},fpa.filter_timeout_time)}});fpa.dom.filter.keyup();fpa.dom.form.delegate('a[href*="admin/people/permissions#"]',"click",function _fpa_inter_page_links_click(e){e.stopPropagation();fpa.dom.module_list.find("li["+fpa.attr.module+'~="'+drupal_html_class(this.hash.substring(8))+'"]').click()});if(window.location.hash.indexOf("module-")===1){fpa.dom.module_list.find("li["+fpa.attr.module+'~="'+drupal_html_class(window.location.hash.substring(8))+'"]').click()}fpa.dom.form.bind("reset",function _fpa_form_reset(){setTimeout(function _fpa_fix_authenticated_behavior(){fpa.dom.table_wrapper.detach().each(function(index,element){$(element).find('input[type="checkbox"]').not(".dummy-checkbox").filter(".rid-2").each(Drupal.behaviors.permissions.toggle)}).appendTo(fpa.dom.section_right)},0)});fpa.dom.table_wrapper.delegate("th["+fpa.attr.role+'] input[type="checkbox"].fpa-checkboxes-toggle',"change",function _fpa_role_permissions_toggle(){var $this=$(this);var filters=fpa.build_filter_selectors(fpa.dom.filter.val());fpa.dom.table_wrapper.detach().each(function(index,element){$(element).find("tr"+filters.join("")+" td.checkbox["+fpa.attr.role+'="'+$this.closest("["+fpa.attr.role+"]").attr(fpa.attr.role)+'"] input[type="checkbox"]').not(".dummy-checkbox").attr("checked",$this.attr("checked")?"checked":"").filter(".rid-2").each(Drupal.behaviors.permissions.toggle)}).appendTo(fpa.dom.section_right)});fpa.dom.table_wrapper.delegate('td.permission input[type="checkbox"].fpa-checkboxes-toggle',"change",function _fpa_role_permissions_toggle(){var $this=$(this);var values=fpa.dom.role_select.val();var filters=fpa.build_role_selectors(values);var $row=$this.closest("tr");var $previous_row=$row.prev("tr");$row.detach().each(function(){$(this).find("td.checkbox").filter(filters.join(",")).find('input[type="checkbox"]').not(".dummy-checkbox").attr("checked",$this.attr("checked")?"checked":"").filter(".rid-2").each(Drupal.behaviors.permissions.toggle)}).insertAfter($previous_row)});fpa.dom.form.delegate(".fpa-clear-search","click",function(){fpa.dom.filter.val("").trigger("keyup")});fpa.dom.role_select.bind("change blur",fpa.filter_roles).change().find("option").mouseout(function(e){e.stopPropagation()});setTimeout(function _fpa_filter_focus(){fpa.dom.filter.focus()},0)};Drupal.behaviors.fpa={attach:function(context,settings){if("ontouchstart"in document.documentElement){$(document.body).addClass("fpa-mobile")}$(window).bind("scroll",function _fpa_fix_tableheader(){$(this).triggerHandler("resize.drupal-tableheader")});fpa.attr=settings.fpa.attr||{module:"fpa-module",permission:"fpa-permission",role:"fpa-role"};if(fpa.select(context)){fpa.prepare()}}}})(jQuery,Drupal);